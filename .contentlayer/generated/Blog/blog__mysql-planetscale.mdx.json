{
  "title": "From Firebase/Redis to MySQL with PlanetScale",
  "publishedAt": "2021-09-06",
  "summary": "Learn how I migrated my Next.js website to use MySQL with PlanetScale, resulting in 10x faster response times for my APIs.",
  "image": "/static/images/mysql-planetscale/banner.png",
  "body": {
    "raw": "\r\nA few weeks ago, I [moved this site](https://github.com/leerob/leerob.io/pull/326) from using [Firebase](/blog/real-time-post-views) and [Redis](/blog/serverless-redis-nextjs) to PlanetScale. [PlanetScale](https://planetscale.com) is a serverless database platform built on MySQL and Vitess. Here's why I picked PlanetScale:\r\n\r\n- **Database Branching:** I'm able to use my database with the same mental model as git. For each change to my database schema, I open a deploy request. Then, I can merge those changes back into my main database branch.\r\n- **Prisma Support:** In combination with Prisma, it's _so easy_ to handle database migrations. I haven't moved to Prisma (yet) but will soon.\r\n- **Connectionless:** Since PlanetScale is serverless, it's built to withstand thousands of simultaneous connections. You can almost consider this _connectionless_ ‚Äì the developer doesn't need to worry about [pooling or other common objections](https://twitter.com/leeerob/status/1430177168307412998).\r\n- **Insanely Fast:** After testing 13 databases, PlanetScale was the [fastest to deploy](https://www.youtube.com/watch?v=0zmYHn82cY8). Now, after using it for a few weeks and monitoring performance, I'm seeing APIs resolve in `~150ms` on average (see [results](#results) below).\r\n\r\nI had a chance to talk with [Nick from PlanetScale](https://www.youtube.com/watch?v=YqBG5rFP4Ic) on a stream last month if you want to see a live demo of the workflow.\r\n\r\n## Why Firebase and Redis?\r\n\r\nThis site previously used [Firebase](/blog/real-time-post-views) and [Redis](/blog/serverless-redis-nextjs) for real-time blog post views and [my guestbook](/guestbook). The primary decision for choosing these technologies was to learn. I learn best by experimenting and building. I even [created a course](https://react2025.com/) showing how to use Firebase with Next.js, if you're interested.\r\n\r\n<StaticTweet id=\"1434355662935314432\" />\r\n\r\nBoth Firebase and Redis (through [Upstash](https://upstash.com/)) are easy to get started, scale without thinking, and work great in serverless environments. However, I wanted to move to something [SQL-based](/blog/backend) (either MySQL or PostgreSQL) for a new learning experience. I've previously written about [choosing your backend](/blog/backend) and landed on PlanetScale.\r\n\r\n## Rebuilding SQL\r\n\r\nI found myself writing JavaScript in places where SQL has the functionality built-in. For example, I used Firebase to fetch a JSON object `views` and then summed the values together to find the total number of views.\r\n\r\n```jsx\r\nconst snapshot = await db.ref('views').once('value');\r\nconst views = snapshot.val();\r\nconst allViews = Object.values(views).reduce((total, value) => total + value);\r\n```\r\n\r\nWith SQL, you can use `SUM()` instead. Easier? Yeah. Better? Probably debatable, but I like it.\r\n\r\n```sql\r\nSELECT SUM(count) as total\r\nFROM views;\r\n```\r\n\r\nSame thing with sorting. Before I was using JavaScript `sort` and now I can use `ORDER BY`. Firebase does have [something similar](https://firebase.google.com/docs/firestore/query-data/order-limit-data), I just wasn't using it.\r\n\r\n```sql\r\nSELECT * FROM guestbook\r\nORDER BY updated_at DESC;\r\n```\r\n\r\n## Why MySQL and PlanetScale?\r\n\r\nSQL is boring, proven technology. It's been around for years and will continue to be around for years. I've used it before in prior jobs, but still felt I could understand it better. I also enjoy using PostgreSQL (and recommend Supabase) and strongly considered that solution as well. I'm planning to build a different project with Supabase soon.\r\n\r\nI'm also a strong believer in using tools I recommend. Without actually getting my hands dirty in code and running an application in production, it's hard to confidently recommend a product to others. After using the [PlanetScale Vercel Integration](https://vercel.com/integrations/planetscale), I was blown away. I could deploy an entire fullstack application in a few clicks. And as I mentioned at the start, database migrations aligned with my mental model.\r\n\r\n<StaticTweet id=\"1426215788407627784\" />\r\n\r\n## Migrating Existing Data\r\n\r\nThere are likely better ways to do this, but my hacky solution to migrate data into PlanetScale was as follows:\r\n\r\n- Export JSON data from my Firebase Realtime Database\r\n\r\n  <Image\r\n    alt={`Exporting data from Firebase`}\r\n    src={`/static/images/mysql-planetscale/firebase.png`}\r\n    width={2905 / 2}\r\n    height={1959 / 2}\r\n  />\r\n\r\n- Export JSON data from my Redis cluster using `HVALS` and TablePlus\r\n\r\n  <Image\r\n    alt={`Exporting data from my Redis cluster`}\r\n    src={`/static/images/mysql-planetscale/redis.png`}\r\n    width={2540 / 2}\r\n    height={1852 / 2}\r\n  />\r\n\r\n- Create a new database branch in PlanetScale for the schema migration adding the tables\r\n- Create two new API routes, which loaded the JSON data and `INSERT INTO` MySQL\r\n- Verify on the database branch the APIs correctly process and migrate the data\r\n- Create a deploy request with the new schema changes and merge it into `main`\r\n- Finally, hit the APIs to migrate the JSON data into `main`\r\n- Done!\r\n\r\nHere are the two scripts I used, for reference.\r\n\r\n```jsx:pages/api/migrate-redis.js\r\nimport db from 'lib/planetscale';\r\nimport guestbookData from 'data/guestbook';\r\n\r\nexport default async function handler(req, res) {\r\n  const toISOString = (unixTimestampInMs) =>\r\n    new Date(unixTimestampInMs).toJSON().slice(0, 19).replace('T', ' ');\r\n\r\n  let query = `INSERT INTO guestbook (email, updated_at, body, created_by)\r\n    VALUES `;\r\n\r\n  const escapeStr = (str) =>\r\n    str\r\n      .replace(/\\\\/g, '\\\\\\\\')\r\n      .replace(/\\$/g, '\\\\$')\r\n      .replace(/'/g, \"\\\\'\")\r\n      .replace(/\"/g, '\\\\\"');\r\n\r\n  guestbookData.forEach((item, key) => {\r\n    var value = JSON.parse(item['value']);\r\n\r\n    query += `(\"${\r\n      value.email ? `${value.email}` : 'not@provided.com'\r\n    }\", \"${toISOString(value.updated_at)}\", \"${escapeStr(value.body)}\", \"${\r\n      value.created_by\r\n    }\")`;\r\n\r\n    if (key === guestbookData.length - 1) {\r\n      query += ';';\r\n    } else {\r\n      query += ', ';\r\n    }\r\n  });\r\n\r\n  const [rows] = await db.query(query);\r\n\r\n  return res.status(201).json(rows[0]);\r\n}\r\n```\r\n\r\n```jsx:pages/api/migrate-firebase.js\r\nimport db from 'lib/planetscale';\r\nimport viewsData from 'data/views';\r\n\r\nexport default async function handler(req, res) {\r\n  let query = `INSERT INTO views (slug, count)\r\n    VALUES `;\r\n\r\n  const slugs = Object.keys(viewsData['views']);\r\n\r\n  slugs.forEach((slug, key) => {\r\n    const count = viewsData['views'][slug];\r\n\r\n    query += `(\"${slug}\", ${count})`;\r\n\r\n    if (key === slugs.length - 1) {\r\n      query += ';';\r\n    } else {\r\n      query += ', ';\r\n    }\r\n  });\r\n\r\n  const [rows] = await db.query(query);\r\n\r\n  return res.status(201).json(rows[0]);\r\n}\r\n```\r\n\r\nHere's my PlanetScale schema for tracking post views and guestbook entries.\r\n\r\n```sql\r\nCREATE TABLE `views` (\r\n  `slug` varchar(128) NOT NULL,\r\n  `count` bigint NOT NULL DEFAULT '1',\r\n  PRIMARY KEY (`slug`)\r\n)\r\n\r\nCREATE TABLE `guestbook` (\r\n  `id` bigint NOT NULL AUTO_INCREMENT,\r\n  `email` varchar(256) NOT NULL,\r\n  `body` varchar(500) NOT NULL,\r\n  `created_by` varchar(256) NOT NULL,\r\n  `created_at` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),\r\n  `updated_at` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),\r\n  PRIMARY KEY (`id`)\r\n)\r\n```\r\n\r\n## Results\r\n\r\nI've been monitoring the performance of my production APIs connecting to PlanetScale with [Checkly](https://www.checklyhq.com). Checkly allows me to set alerts if there's downtime or if performance decreases below my accepted threshold. For the last week, I've seen latency of `~150ms` for my Next.js API Routes, deployed as serverless functions on [Vercel](https://vercel.com) in `us-east`.\r\n\r\n<Image\r\n  alt={`Checkly results from PlanetScale database`}\r\n  src={`/static/images/mysql-planetscale/checkly.png`}\r\n  width={1490}\r\n  height={528}\r\n/>\r\n\r\nThis has been significantly faster than my previous Firebase implementation. Can you tell when I made the switch? üòÅ\r\n\r\n<Image\r\n  alt={`Checkly results after switching from Firebase to PlanetScale`}\r\n  src={`/static/images/mysql-planetscale/checkly-firebase.png`}\r\n  width={2264 / 2}\r\n  height={1076 / 2}\r\n/>\r\n\r\nI'm pleased with the results of the migration. Having one service instead of two cleaned up the code and required fewer environment variables to connect to each service. I was also somewhat _abusing_ Redis for my guestbook, where SQL is a better fit.\r\n\r\nNext up, Prisma!\r\n",
    "code": "var Component=(()=>{var h=Object.create;var l=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var N=Object.getPrototypeOf,k=Object.prototype.hasOwnProperty;var g=(a,e)=>()=>(e||a((e={exports:{}}).exports,e),e.exports),y=(a,e)=>{for(var s in e)l(a,s,{get:e[s],enumerable:!0})},i=(a,e,s,c)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let t of u(e))!k.call(a,t)&&t!==s&&l(a,t,{get:()=>e[t],enumerable:!(c=m(e,t))||c.enumerable});return a};var w=(a,e,s)=>(s=a!=null?h(N(a)):{},i(e||!a||!a.__esModule?l(s,\"default\",{value:a,enumerable:!0}):s,a)),f=a=>i(l({},\"__esModule\",{value:!0}),a);var r=g((L,o)=>{o.exports=_jsx_runtime});var x={};y(x,{default:()=>S,frontmatter:()=>b});var n=w(r()),b={title:\"From Firebase/Redis to MySQL with PlanetScale\",publishedAt:\"2021-09-06\",summary:\"Learn how I migrated my Next.js website to use MySQL with PlanetScale, resulting in 10x faster response times for my APIs.\",image:\"/static/images/mysql-planetscale/banner.png\"};function p(a){let e=Object.assign({p:\"p\",a:\"a\",ul:\"ul\",li:\"li\",strong:\"strong\",em:\"em\",code:\"code\",h2:\"h2\",span:\"span\",pre:\"pre\",div:\"div\"},a.components),{StaticTweet:s,Image:c}=e;return c||d(\"Image\",!0,\"63:3-68:5\"),s||d(\"StaticTweet\",!0,\"21:1-21:41\"),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.p,{children:[\"A few weeks ago, I \",(0,n.jsx)(e.a,{href:\"https://github.com/leerob/leerob.io/pull/326\",children:\"moved this site\"}),\" from using \",(0,n.jsx)(e.a,{href:\"/blog/real-time-post-views\",children:\"Firebase\"}),\" and \",(0,n.jsx)(e.a,{href:\"/blog/serverless-redis-nextjs\",children:\"Redis\"}),\" to PlanetScale. \",(0,n.jsx)(e.a,{href:\"https://planetscale.com\",children:\"PlanetScale\"}),\" is a serverless database platform built on MySQL and Vitess. Here's why I picked PlanetScale:\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Database Branching:\"}),\" I'm able to use my database with the same mental model as git. For each change to my database schema, I open a deploy request. Then, I can merge those changes back into my main database branch.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Prisma Support:\"}),\" In combination with Prisma, it's \",(0,n.jsx)(e.em,{children:\"so easy\"}),\" to handle database migrations. I haven't moved to Prisma (yet) but will soon.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Connectionless:\"}),\" Since PlanetScale is serverless, it's built to withstand thousands of simultaneous connections. You can almost consider this \",(0,n.jsx)(e.em,{children:\"connectionless\"}),\" \\u2013 the developer doesn't need to worry about \",(0,n.jsx)(e.a,{href:\"https://twitter.com/leeerob/status/1430177168307412998\",children:\"pooling or other common objections\"}),\".\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Insanely Fast:\"}),\" After testing 13 databases, PlanetScale was the \",(0,n.jsx)(e.a,{href:\"https://www.youtube.com/watch?v=0zmYHn82cY8\",children:\"fastest to deploy\"}),\". Now, after using it for a few weeks and monitoring performance, I'm seeing APIs resolve in \",(0,n.jsx)(e.code,{children:\"~150ms\"}),\" on average (see \",(0,n.jsx)(e.a,{href:\"#results\",children:\"results\"}),\" below).\"]}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"I had a chance to talk with \",(0,n.jsx)(e.a,{href:\"https://www.youtube.com/watch?v=YqBG5rFP4Ic\",children:\"Nick from PlanetScale\"}),\" on a stream last month if you want to see a live demo of the workflow.\"]}),`\n`,(0,n.jsxs)(e.h2,{id:\"why-firebase-and-redis\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#why-firebase-and-redis\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Why Firebase and Redis?\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"This site previously used \",(0,n.jsx)(e.a,{href:\"/blog/real-time-post-views\",children:\"Firebase\"}),\" and \",(0,n.jsx)(e.a,{href:\"/blog/serverless-redis-nextjs\",children:\"Redis\"}),\" for real-time blog post views and \",(0,n.jsx)(e.a,{href:\"/guestbook\",children:\"my guestbook\"}),\". The primary decision for choosing these technologies was to learn. I learn best by experimenting and building. I even \",(0,n.jsx)(e.a,{href:\"https://react2025.com/\",children:\"created a course\"}),\" showing how to use Firebase with Next.js, if you're interested.\"]}),`\n`,(0,n.jsx)(s,{id:\"1434355662935314432\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Both Firebase and Redis (through \",(0,n.jsx)(e.a,{href:\"https://upstash.com/\",children:\"Upstash\"}),\") are easy to get started, scale without thinking, and work great in serverless environments. However, I wanted to move to something \",(0,n.jsx)(e.a,{href:\"/blog/backend\",children:\"SQL-based\"}),\" (either MySQL or PostgreSQL) for a new learning experience. I've previously written about \",(0,n.jsx)(e.a,{href:\"/blog/backend\",children:\"choosing your backend\"}),\" and landed on PlanetScale.\"]}),`\n`,(0,n.jsxs)(e.h2,{id:\"rebuilding-sql\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#rebuilding-sql\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Rebuilding SQL\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"I found myself writing JavaScript in places where SQL has the functionality built-in. For example, I used Firebase to fetch a JSON object \",(0,n.jsx)(e.code,{children:\"views\"}),\" and then summed the values together to find the total number of views.\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-jsx\",children:(0,n.jsxs)(e.code,{className:\"language-jsx code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" snapshot \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"await\"}),\" db\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"ref\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'views'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"once\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'value'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" views \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" snapshot\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"val\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" allViews \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token known-class-name class-name\",children:\"Object\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"values\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"views\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"reduce\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token parameter\",children:[\"total\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" value\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token arrow operator\",children:\"=>\"}),\" total \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" value\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"With SQL, you can use \",(0,n.jsx)(e.code,{children:\"SUM()\"}),\" instead. Easier? Yeah. Better? Probably debatable, but I like it.\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-sql\",children:(0,n.jsxs)(e.code,{className:\"language-sql code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"SELECT\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"SUM\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"count\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),` total\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"FROM\"}),\" views\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Same thing with sorting. Before I was using JavaScript \",(0,n.jsx)(e.code,{children:\"sort\"}),\" and now I can use \",(0,n.jsx)(e.code,{children:\"ORDER BY\"}),\". Firebase does have \",(0,n.jsx)(e.a,{href:\"https://firebase.google.com/docs/firestore/query-data/order-limit-data\",children:\"something similar\"}),\", I just wasn't using it.\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-sql\",children:(0,n.jsxs)(e.code,{className:\"language-sql code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"SELECT\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"FROM\"}),` guestbook\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"ORDER\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"BY\"}),\" updated_at \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"DESC\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.h2,{id:\"why-mysql-and-planetscale\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#why-mysql-and-planetscale\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Why MySQL and PlanetScale?\"]}),`\n`,(0,n.jsx)(e.p,{children:\"SQL is boring, proven technology. It's been around for years and will continue to be around for years. I've used it before in prior jobs, but still felt I could understand it better. I also enjoy using PostgreSQL (and recommend Supabase) and strongly considered that solution as well. I'm planning to build a different project with Supabase soon.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"I'm also a strong believer in using tools I recommend. Without actually getting my hands dirty in code and running an application in production, it's hard to confidently recommend a product to others. After using the \",(0,n.jsx)(e.a,{href:\"https://vercel.com/integrations/planetscale\",children:\"PlanetScale Vercel Integration\"}),\", I was blown away. I could deploy an entire fullstack application in a few clicks. And as I mentioned at the start, database migrations aligned with my mental model.\"]}),`\n`,(0,n.jsx)(s,{id:\"1426215788407627784\"}),`\n`,(0,n.jsxs)(e.h2,{id:\"migrating-existing-data\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#migrating-existing-data\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Migrating Existing Data\"]}),`\n`,(0,n.jsx)(e.p,{children:\"There are likely better ways to do this, but my hacky solution to migrate data into PlanetScale was as follows:\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsx)(e.p,{children:\"Export JSON data from my Firebase Realtime Database\"}),`\n`,(0,n.jsx)(c,{alt:\"Exporting data from Firebase\",src:\"/static/images/mysql-planetscale/firebase.png\",width:2905/2,height:1959/2}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsxs)(e.p,{children:[\"Export JSON data from my Redis cluster using \",(0,n.jsx)(e.code,{children:\"HVALS\"}),\" and TablePlus\"]}),`\n`,(0,n.jsx)(c,{alt:\"Exporting data from my Redis cluster\",src:\"/static/images/mysql-planetscale/redis.png\",width:2540/2,height:1852/2}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsx)(e.p,{children:\"Create a new database branch in PlanetScale for the schema migration adding the tables\"}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsxs)(e.p,{children:[\"Create two new API routes, which loaded the JSON data and \",(0,n.jsx)(e.code,{children:\"INSERT INTO\"}),\" MySQL\"]}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsx)(e.p,{children:\"Verify on the database branch the APIs correctly process and migrate the data\"}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsxs)(e.p,{children:[\"Create a deploy request with the new schema changes and merge it into \",(0,n.jsx)(e.code,{children:\"main\"})]}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsxs)(e.p,{children:[\"Finally, hit the APIs to migrate the JSON data into \",(0,n.jsx)(e.code,{children:\"main\"})]}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsx)(e.p,{children:\"Done!\"}),`\n`]}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"Here are the two scripts I used, for reference.\"}),`\n`,(0,n.jsx)(e.div,{className:\"rehype-code-title\",children:\"pages/api/migrate-redis.js\"}),(0,n.jsx)(e.pre,{className:\"language-jsx\",children:(0,n.jsxs)(e.code,{className:\"language-jsx code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"import\"}),\" \",(0,n.jsx)(e.span,{className:\"token imports\",children:\"db\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'lib/planetscale'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"import\"}),\" \",(0,n.jsx)(e.span,{className:\"token imports\",children:\"guestbookData\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'data/guestbook'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"export\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"default\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"handler\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token parameter\",children:[\"req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" res\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token function-variable function\",children:\"toISOString\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token parameter\",children:\"unixTimestampInMs\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token arrow operator\",children:\"=>\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Date\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"unixTimestampInMs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"toJSON\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"slice\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"19\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"replace\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'T'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"' '\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"let\"}),\" query \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsxs)(e.span,{className:\"token template-string\",children:[(0,n.jsx)(e.span,{className:\"token template-punctuation string\",children:\"`\"}),(0,n.jsx)(e.span,{className:\"token string\",children:`INSERT INTO guestbook (email, updated_at, body, created_by)\\r\n`})]})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token template-string\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:\"    VALUES \"}),(0,n.jsx)(e.span,{className:\"token template-punctuation string\",children:\"`\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token function-variable function\",children:\"escapeStr\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token parameter\",children:\"str\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token arrow operator\",children:\"=>\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    str\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"replace\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token regex\",children:[(0,n.jsx)(e.span,{className:\"token regex-delimiter\",children:\"/\"}),(0,n.jsx)(e.span,{className:\"token regex-source language-regex\",children:(0,n.jsx)(e.span,{className:\"token special-escape escape\",children:\"\\\\\\\\\"})}),(0,n.jsx)(e.span,{className:\"token regex-delimiter\",children:\"/\"}),(0,n.jsx)(e.span,{className:\"token regex-flags\",children:\"g\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'\\\\\\\\\\\\\\\\'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"replace\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token regex\",children:[(0,n.jsx)(e.span,{className:\"token regex-delimiter\",children:\"/\"}),(0,n.jsx)(e.span,{className:\"token regex-source language-regex\",children:(0,n.jsx)(e.span,{className:\"token special-escape escape\",children:\"\\\\$\"})}),(0,n.jsx)(e.span,{className:\"token regex-delimiter\",children:\"/\"}),(0,n.jsx)(e.span,{className:\"token regex-flags\",children:\"g\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'\\\\\\\\$'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"replace\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token regex\",children:[(0,n.jsx)(e.span,{className:\"token regex-delimiter\",children:\"/\"}),(0,n.jsx)(e.span,{className:\"token regex-source language-regex\",children:\"'\"}),(0,n.jsx)(e.span,{className:\"token regex-delimiter\",children:\"/\"}),(0,n.jsx)(e.span,{className:\"token regex-flags\",children:\"g\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:`\"\\\\\\\\'\"`}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"replace\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token regex\",children:[(0,n.jsx)(e.span,{className:\"token regex-delimiter\",children:\"/\"}),(0,n.jsx)(e.span,{className:\"token regex-source language-regex\",children:'\"'}),(0,n.jsx)(e.span,{className:\"token regex-delimiter\",children:\"/\"}),(0,n.jsx)(e.span,{className:\"token regex-flags\",children:\"g\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:`'\\\\\\\\\"'`}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  guestbookData\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"forEach\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token parameter\",children:[\"item\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" key\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token arrow operator\",children:\"=>\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"var\"}),\" value \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token known-class-name class-name\",children:\"JSON\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"parse\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"item\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'value'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    query \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+=\"}),\" \",(0,n.jsxs)(e.span,{className:\"token template-string\",children:[(0,n.jsx)(e.span,{className:\"token template-punctuation string\",children:\"`\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'(\"'}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token interpolation-punctuation punctuation\",children:\"${\"}),`\\r\n`]})]})]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token template-string\",children:(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[\"      value\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"email\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),\" \",(0,n.jsxs)(e.span,{className:\"token template-string\",children:[(0,n.jsx)(e.span,{className:\"token template-punctuation string\",children:\"`\"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token interpolation-punctuation punctuation\",children:\"${\"}),\"value\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"email\"}),(0,n.jsx)(e.span,{className:\"token interpolation-punctuation punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token template-punctuation string\",children:\"`\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'not@provided.com'\"}),`\\r\n`]})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsxs)(e.span,{className:\"token template-string\",children:[(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token interpolation-punctuation punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'\", \"'}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token interpolation-punctuation punctuation\",children:\"${\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"toISOString\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"value\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"updated_at\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token interpolation-punctuation punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'\", \"'}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token interpolation-punctuation punctuation\",children:\"${\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"escapeStr\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"value\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"body\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token interpolation-punctuation punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'\", \"'}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token interpolation-punctuation punctuation\",children:\"${\"}),`\\r\n`]})]})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token template-string\",children:(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[\"      value\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"created_by\"}),`\\r\n`]})})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token template-string\",children:[(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token interpolation-punctuation punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'\")'}),(0,n.jsx)(e.span,{className:\"token template-punctuation string\",children:\"`\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"key \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"===\"}),\" guestbookData\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"length\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      query \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"';'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"else\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      query \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"', '\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"rows\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"await\"}),\" db\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"query\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"query\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"return\"}),\" res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"status\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"201\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"json\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"rows\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.div,{className:\"rehype-code-title\",children:\"pages/api/migrate-firebase.js\"}),(0,n.jsx)(e.pre,{className:\"language-jsx\",children:(0,n.jsxs)(e.code,{className:\"language-jsx code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"import\"}),\" \",(0,n.jsx)(e.span,{className:\"token imports\",children:\"db\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'lib/planetscale'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"import\"}),\" \",(0,n.jsx)(e.span,{className:\"token imports\",children:\"viewsData\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'data/views'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"export\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"default\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"handler\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token parameter\",children:[\"req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" res\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"let\"}),\" query \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsxs)(e.span,{className:\"token template-string\",children:[(0,n.jsx)(e.span,{className:\"token template-punctuation string\",children:\"`\"}),(0,n.jsx)(e.span,{className:\"token string\",children:`INSERT INTO views (slug, count)\\r\n`})]})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token template-string\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:\"    VALUES \"}),(0,n.jsx)(e.span,{className:\"token template-punctuation string\",children:\"`\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" slugs \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token known-class-name class-name\",children:\"Object\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"keys\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"viewsData\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'views'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  slugs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"forEach\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token parameter\",children:[\"slug\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" key\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token arrow operator\",children:\"=>\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" count \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" viewsData\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'views'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"slug\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    query \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+=\"}),\" \",(0,n.jsxs)(e.span,{className:\"token template-string\",children:[(0,n.jsx)(e.span,{className:\"token template-punctuation string\",children:\"`\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'(\"'}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token interpolation-punctuation punctuation\",children:\"${\"}),\"slug\",(0,n.jsx)(e.span,{className:\"token interpolation-punctuation punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'\", '}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token interpolation-punctuation punctuation\",children:\"${\"}),\"count\",(0,n.jsx)(e.span,{className:\"token interpolation-punctuation punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token template-punctuation string\",children:\"`\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"key \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"===\"}),\" slugs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"length\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      query \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"';'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"else\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      query \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"', '\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"rows\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"await\"}),\" db\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"query\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"query\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"return\"}),\" res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"status\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"201\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"json\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"rows\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Here's my PlanetScale schema for tracking post views and guestbook entries.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-sql\",children:(0,n.jsxs)(e.code,{className:\"language-sql code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"CREATE\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"TABLE\"}),\" \",(0,n.jsxs)(e.span,{className:\"token identifier\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"`\"}),\"views\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"`\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(e.span,{className:\"token identifier\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"`\"}),\"slug\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"`\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"varchar\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"128\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"NOT\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"NULL\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(e.span,{className:\"token identifier\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"`\"}),\"count\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"`\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"bigint\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"NOT\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"NULL\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"DEFAULT\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'1'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"PRIMARY\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"KEY\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token identifier\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"`\"}),\"slug\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"`\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"CREATE\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"TABLE\"}),\" \",(0,n.jsxs)(e.span,{className:\"token identifier\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"`\"}),\"guestbook\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"`\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(e.span,{className:\"token identifier\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"`\"}),\"id\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"`\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"bigint\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"NOT\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"NULL\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"AUTO_INCREMENT\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(e.span,{className:\"token identifier\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"`\"}),\"email\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"`\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"varchar\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"256\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"NOT\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"NULL\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(e.span,{className:\"token identifier\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"`\"}),\"body\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"`\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"varchar\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"500\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"NOT\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"NULL\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(e.span,{className:\"token identifier\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"`\"}),\"created_by\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"`\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"varchar\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"256\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"NOT\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"NULL\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(e.span,{className:\"token identifier\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"`\"}),\"created_at\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"`\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"datetime\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"6\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"NOT\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"NULL\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"DEFAULT\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"CURRENT_TIMESTAMP\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"6\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(e.span,{className:\"token identifier\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"`\"}),\"updated_at\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"`\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"datetime\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"6\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"NOT\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"NULL\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"DEFAULT\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"CURRENT_TIMESTAMP\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"6\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"PRIMARY\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"KEY\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token identifier\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"`\"}),\"id\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"`\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.h2,{id:\"results\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#results\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Results\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"I've been monitoring the performance of my production APIs connecting to PlanetScale with \",(0,n.jsx)(e.a,{href:\"https://www.checklyhq.com\",children:\"Checkly\"}),\". Checkly allows me to set alerts if there's downtime or if performance decreases below my accepted threshold. For the last week, I've seen latency of \",(0,n.jsx)(e.code,{children:\"~150ms\"}),\" for my Next.js API Routes, deployed as serverless functions on \",(0,n.jsx)(e.a,{href:\"https://vercel.com\",children:\"Vercel\"}),\" in \",(0,n.jsx)(e.code,{children:\"us-east\"}),\".\"]}),`\n`,(0,n.jsx)(c,{alt:\"Checkly results from PlanetScale database\",src:\"/static/images/mysql-planetscale/checkly.png\",width:1490,height:528}),`\n`,(0,n.jsx)(e.p,{children:\"This has been significantly faster than my previous Firebase implementation. Can you tell when I made the switch? \\u{1F601}\"}),`\n`,(0,n.jsx)(c,{alt:\"Checkly results after switching from Firebase to PlanetScale\",src:\"/static/images/mysql-planetscale/checkly-firebase.png\",width:2264/2,height:1076/2}),`\n`,(0,n.jsxs)(e.p,{children:[\"I'm pleased with the results of the migration. Having one service instead of two cleaned up the code and required fewer environment variables to connect to each service. I was also somewhat \",(0,n.jsx)(e.em,{children:\"abusing\"}),\" Redis for my guestbook, where SQL is a better fit.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Next up, Prisma!\"})]})}function v(a={}){let{wrapper:e}=a.components||{};return e?(0,n.jsx)(e,Object.assign({},a,{children:(0,n.jsx)(p,a)})):p(a)}var S=v;function d(a,e,s){throw new Error(\"Expected \"+(e?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\"+(s?\"\\nIt\\u2019s referenced in your code at `\"+s+\"` in `D:\\\\Linux_Share\\\\reactapp\\\\rifan-blog\\\\data\\\\blog\\\\_mdx_bundler_entry_point-afdba1a4-e5e4-426d-90ff-0adc07686864.mdx`\":\"\"))}return f(x);})();\n;return Component;"
  },
  "_id": "blog/mysql-planetscale.mdx",
  "_raw": {
    "sourceFilePath": "blog/mysql-planetscale.mdx",
    "sourceFileName": "mysql-planetscale.mdx",
    "sourceFileDir": "blog",
    "contentType": "mdx",
    "flattenedPath": "blog/mysql-planetscale"
  },
  "type": "Blog",
  "readingTime": {
    "text": "6 min read",
    "minutes": 5.44,
    "time": 326400,
    "words": 1088
  },
  "wordCount": 1090,
  "tweetIds": [
    "1434355662935314432",
    "1426215788407627784"
  ],
  "slug": "mysql-planetscale"
}