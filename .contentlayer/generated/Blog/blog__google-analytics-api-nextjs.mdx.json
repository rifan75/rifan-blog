{
  "title": "Create a Dashboard with Next.js API Routes - Google Analytics API",
  "publishedAt": "2020-02-18",
  "summary": "Learn how to use Next.js API routes to integrate with the Google Analytics API and retrieve statistics about a site.",
  "image": "/static/images/banner.png",
  "body": {
    "raw": "\r\n> In this series, you will learn how to [create a dashboard](/dashboard) using Next.js API routes and integrate with third-party APIs.\r\n\r\n<Analytics />\r\n\r\n## Overview\r\n\r\nGoogle Analytics is, by far, the most popular analytics platform. In this post, we'll look at how\r\nwe can retrieve the number of page views in a specific time range programmatically.\r\n\r\nIf you're more concerned about privacy, you might consider using [Fathom Analytics](https://usefathom.com/ref/T93GOJ) or [SimpleAnalytics](https://simpleanalytics.com/).\r\n\r\n**Note:** You'll need to turn off your ad blocker for this page to work.\r\n\r\n## Getting Access to Google Analytics\r\n\r\nTo gain access to the Google Analytics API, you need to:\r\n\r\n- Go to the [Google Developer Console.](https://console.developers.google.com/)\r\n- Create a new project.\r\n- Credentials -> Create Credentials -> Service-account key.\r\n- Click \"Enable APIs and services.\"\r\n- Find \"Google Analytics API\" and enable it.\r\n\r\nSince we're communicating server-to-server, we'll need a [service account](https://developers.google.com/identity/protocols/OAuth2ServiceAccount).\r\n\r\n- Go to your [service accounts](https://console.developers.google.com/iam-admin/serviceaccounts) page.\r\n- Create a service account.\r\n- Click \"Create Key\" and choose JSON.\r\n\r\nYou should now have a JSON file similar to this:\r\n\r\n```json\r\n{\r\n  \"type\": \"service_account\",\r\n  \"project_id\": \"...\",\r\n  \"private_key_id\": \"...\",\r\n  \"private_key\": \"...\",\r\n  \"client_email\": \"...\",\r\n  \"client_id\": \"...\",\r\n  \"auth_uri\": \"https://accounts.google.com/o/oauth2/auth\",\r\n  \"token_uri\": \"https://accounts.google.com/o/oauth2/token\",\r\n  \"auth_provider_x509_cert_url\": \"https://www.googleapis.com/oauth2/v1/certs\",\r\n  \"client_x509_cert_url\": \"...\"\r\n}\r\n```\r\n\r\nWe use this key later to set up our client in our API Route.\r\nOkay, back to the [service account](https://console.developers.google.com/iam-admin/serviceaccounts).\r\nWe need to delegate [domain-wide authority](https://developers.google.com/identity/protocols/OAuth2ServiceAccount#delegatingauthority).\r\n\r\n- On the table row, click Actions -> Edit.\r\n- Show Domain-Wide Delegation -> Enable G-Suite Domain-Wide Delegation.\r\n\r\nFinally, we need to add our service account email to the Google Analytics account we want to use.\r\n\r\n- Go to the Admin panel inside Google Analytics.\r\n- Click \"User Management.\"\r\n- Add the `client_email` from your service account.\r\n\r\n**That's it!** ðŸŽ‰ You now have access to make requests to the Google Analytics API with your service account.\r\n\r\n## Creating an environment variable\r\n\r\nTo securely access the API, we need to include the secret with each request.\r\nWe also _do not_ want to commit secrets to git. Thus, we should use an environment variable.\r\n\r\nSince I'm deploying with [Vercel](https://vercel.com), I can add the secrets via their CLI.\r\nWe only need a few of the values from the JSON file. For the private key, make sure you convert\r\nthe new line characters (`\\n`) to actual new lines.\r\n\r\n```bash\r\n$ vc secret add -- google-private-key \"-----BEGIN PRIVATE KEY-----\r\nMIIEvQIBA\r\n..\r\n..\r\n2DAVOW4c=\r\n-----END PRIVATE KEY-----\"\r\n$ vc secret add google-client-email my-account@project.iam.gserviceaccount.com\r\n$ vc secret add google-client-id 721877721877\r\n```\r\n\r\nTo reference these values locally when using `vc dev`, they need to be added to your `.env` file.\r\n\r\n```bash\r\nGOOGLE_PRIVATE_KEY=\"-----BEGIN PRIVATE KEY-----\\nDVOW4c=\\n-----END PRIVATE KEY-----\\n\"\r\nGOOGLE_CLIENT_EMAIL=my-account@project.iam.gserviceaccount.com\r\n```\r\n\r\nFinally, we need to add the secrets to our `vercel.json`.\r\n\r\n```json:vercel.json\r\n{\r\n  \"env\": {\r\n    \"GOOGLE_PRIVATE_KEY\": \"@google-private-key\",\r\n    \"GOOGLE_CLIENT_EMAIL\": \"@google-client-email\"\r\n  }\r\n}\r\n```\r\n\r\nWe can now reference the secrets via `process.env.GOOGLE_PRIVATE_KEY` in our API route.\r\n\r\n**Note:** If you have a lot of environment variables in Vercel, you might need to [encrypt your service account](https://vercel.com/support/articles/how-do-i-workaround-vercel-s-4-kb-environment-variables-limit).\r\n\r\n## Creating the API Route\r\n\r\nLet's start by creating a new API route at `pages/api/page-views.js`.\r\n\r\n```js\r\nexport default (req, res) => {\r\n  return res.status(200).json({});\r\n};\r\n```\r\n\r\nTo make server-side requests to Google Analytics, we can install the [googleapis](https://github.com/googleapis/google-api-nodejs-client) library.\r\n\r\n```bash\r\n$ yarn add googleapis@48.0.0\r\n```\r\n\r\nThen, we can initialize `googleapis` inside our API route.\r\n\r\n```js\r\nimport { google } from 'googleapis';\r\n\r\nlet googleAuth;\r\n\r\nexport default async (_, res) => {\r\n  googleAuth = new google.auth.GoogleAuth({\r\n    credentials: {\r\n      client_email: process.env.GOOGLE_CLIENT_EMAIL,\r\n      private_key: process.env.GOOGLE_PRIVATE_KEY\r\n    },\r\n    scopes: ['https://www.googleapis.com/auth/analytics.readonly']\r\n  });\r\n\r\n  const analytics = google.analytics({\r\n    auth,\r\n    version: 'v3'\r\n  });\r\n\r\n  return res.status(200).json({});\r\n};\r\n```\r\n\r\nFinally, we want to pull statistics about our site. We'd like to know the total number of views for a given time range.\r\nTo allow the API route to be re-used, let's pass the start date as a query parameter.\r\n\r\n```js\r\nconst startDate = req.query.startDate;\r\n```\r\n\r\nThen, we can use the same API route to fetch stats about different time ranges.\r\n\r\n```js\r\nimport { google } from 'googleapis';\r\n\r\nlet googleAuth;\r\n\r\nexport default async (_, res) => {\r\n  googleAuth = new google.auth.GoogleAuth({\r\n    credentials: {\r\n      client_email: process.env.GOOGLE_CLIENT_EMAIL,\r\n      private_key: process.env.GOOGLE_PRIVATE_KEY\r\n    },\r\n    scopes: ['https://www.googleapis.com/auth/analytics.readonly']\r\n  });\r\n\r\n  const analytics = google.analytics({\r\n    auth,\r\n    version: 'v3'\r\n  });\r\n\r\n  const startDate = req.query.startDate;\r\n  const response = await analytics.data.ga.get({\r\n    'end-date': 'today',\r\n    ids: 'ga:186371021',\r\n    metrics: 'ga:pageviews',\r\n    'start-date': startDate\r\n  });\r\n\r\n  return res.status(200).json({\r\n    pageViews: response.data.rows[0][0]\r\n  });\r\n};\r\n```\r\n\r\n## Example\r\n\r\n_Bonus_: You can cache the API route with the [cache-control](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control) header.\r\n\r\n```bash\r\nCache-Control: public, max-age=120, stale-while-revalidate=60\r\n```\r\n\r\n<Analytics />\r\n\r\n## Keep Reading\r\n\r\n**Create a Dashboard with Next.js API Routes**\r\n\r\n- Part 1 - [Unsplash API](/blog/unsplash-api-nextjs)\r\n- Part 2 - [YouTube API](/blog/youtube-api-nextjs)\r\n- Part 3 - [Google Analytics API](/blog/google-analytics-api-nextjs)\r\n- Part 4 - [Fetching Data with SWR](/blog/fetching-data-with-swr)\r\n",
    "code": "var Component=(()=>{var d=Object.create;var l=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var u=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty;var k=(a,e)=>()=>(e||a((e={exports:{}}).exports,e),e.exports),g=(a,e)=>{for(var s in e)l(a,s,{get:e[s],enumerable:!0})},o=(a,e,s,t)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let c of m(e))!N.call(a,c)&&c!==s&&l(a,c,{get:()=>e[c],enumerable:!(t=h(e,c))||t.enumerable});return a};var y=(a,e,s)=>(s=a!=null?d(u(a)):{},o(e||!a||!a.__esModule?l(s,\"default\",{value:a,enumerable:!0}):s,a)),w=a=>o(l({},\"__esModule\",{value:!0}),a);var i=k((E,r)=>{r.exports=_jsx_runtime});var _={};g(_,{default:()=>b,frontmatter:()=>v});var n=y(i()),v={title:\"Create a Dashboard with Next.js API Routes - Google Analytics API\",publishedAt:\"2020-02-18\",summary:\"Learn how to use Next.js API routes to integrate with the Google Analytics API and retrieve statistics about a site.\",image:\"/static/images/banner.png\"};function p(a){let e=Object.assign({blockquote:\"blockquote\",p:\"p\",a:\"a\",h2:\"h2\",span:\"span\",strong:\"strong\",ul:\"ul\",li:\"li\",pre:\"pre\",code:\"code\",em:\"em\",div:\"div\"},a.components),{Analytics:s}=e;return s||A(\"Analytics\",!0,\"10:1-10:14\"),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.blockquote,{children:[`\n`,(0,n.jsxs)(e.p,{children:[\"In this series, you will learn how to \",(0,n.jsx)(e.a,{href:\"/dashboard\",children:\"create a dashboard\"}),\" using Next.js API routes and integrate with third-party APIs.\"]}),`\n`]}),`\n`,(0,n.jsx)(s,{}),`\n`,(0,n.jsxs)(e.h2,{id:\"overview\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#overview\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Overview\"]}),`\n`,(0,n.jsx)(e.p,{children:`Google Analytics is, by far, the most popular analytics platform. In this post, we'll look at how\\r\nwe can retrieve the number of page views in a specific time range programmatically.`}),`\n`,(0,n.jsxs)(e.p,{children:[\"If you're more concerned about privacy, you might consider using \",(0,n.jsx)(e.a,{href:\"https://usefathom.com/ref/T93GOJ\",children:\"Fathom Analytics\"}),\" or \",(0,n.jsx)(e.a,{href:\"https://simpleanalytics.com/\",children:\"SimpleAnalytics\"}),\".\"]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.strong,{children:\"Note:\"}),\" You'll need to turn off your ad blocker for this page to work.\"]}),`\n`,(0,n.jsxs)(e.h2,{id:\"getting-access-to-google-analytics\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#getting-access-to-google-analytics\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Getting Access to Google Analytics\"]}),`\n`,(0,n.jsx)(e.p,{children:\"To gain access to the Google Analytics API, you need to:\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"Go to the \",(0,n.jsx)(e.a,{href:\"https://console.developers.google.com/\",children:\"Google Developer Console.\"})]}),`\n`,(0,n.jsx)(e.li,{children:\"Create a new project.\"}),`\n`,(0,n.jsx)(e.li,{children:\"Credentials -> Create Credentials -> Service-account key.\"}),`\n`,(0,n.jsx)(e.li,{children:'Click \"Enable APIs and services.\"'}),`\n`,(0,n.jsx)(e.li,{children:'Find \"Google Analytics API\" and enable it.'}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Since we're communicating server-to-server, we'll need a \",(0,n.jsx)(e.a,{href:\"https://developers.google.com/identity/protocols/OAuth2ServiceAccount\",children:\"service account\"}),\".\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"Go to your \",(0,n.jsx)(e.a,{href:\"https://console.developers.google.com/iam-admin/serviceaccounts\",children:\"service accounts\"}),\" page.\"]}),`\n`,(0,n.jsx)(e.li,{children:\"Create a service account.\"}),`\n`,(0,n.jsx)(e.li,{children:'Click \"Create Key\" and choose JSON.'}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"You should now have a JSON file similar to this:\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-json\",children:(0,n.jsxs)(e.code,{className:\"language-json code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"type\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"service_account\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"project_id\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"...\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"private_key_id\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"...\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"private_key\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"...\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"client_email\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"...\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"client_id\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"...\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"auth_uri\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"https://accounts.google.com/o/oauth2/auth\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"token_uri\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"https://accounts.google.com/o/oauth2/token\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"auth_provider_x509_cert_url\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"https://www.googleapis.com/oauth2/v1/certs\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"client_x509_cert_url\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"...\"'}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[`We use this key later to set up our client in our API Route.\\r\nOkay, back to the `,(0,n.jsx)(e.a,{href:\"https://console.developers.google.com/iam-admin/serviceaccounts\",children:\"service account\"}),`.\\r\nWe need to delegate `,(0,n.jsx)(e.a,{href:\"https://developers.google.com/identity/protocols/OAuth2ServiceAccount#delegatingauthority\",children:\"domain-wide authority\"}),\".\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"On the table row, click Actions -> Edit.\"}),`\n`,(0,n.jsx)(e.li,{children:\"Show Domain-Wide Delegation -> Enable G-Suite Domain-Wide Delegation.\"}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"Finally, we need to add our service account email to the Google Analytics account we want to use.\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"Go to the Admin panel inside Google Analytics.\"}),`\n`,(0,n.jsx)(e.li,{children:'Click \"User Management.\"'}),`\n`,(0,n.jsxs)(e.li,{children:[\"Add the \",(0,n.jsx)(e.code,{children:\"client_email\"}),\" from your service account.\"]}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.strong,{children:\"That's it!\"}),\" \\u{1F389} You now have access to make requests to the Google Analytics API with your service account.\"]}),`\n`,(0,n.jsxs)(e.h2,{id:\"creating-an-environment-variable\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#creating-an-environment-variable\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Creating an environment variable\"]}),`\n`,(0,n.jsxs)(e.p,{children:[`To securely access the API, we need to include the secret with each request.\\r\nWe also `,(0,n.jsx)(e.em,{children:\"do not\"}),\" want to commit secrets to git. Thus, we should use an environment variable.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Since I'm deploying with \",(0,n.jsx)(e.a,{href:\"https://vercel.com\",children:\"Vercel\"}),`, I can add the secrets via their CLI.\\r\nWe only need a few of the values from the JSON file. For the private key, make sure you convert\\r\nthe new line characters (`,(0,n.jsx)(e.code,{children:\"\\\\n\"}),\") to actual new lines.\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"$ vc secret \",(0,n.jsx)(e.span,{className:\"token function\",children:\"add\"}),\" -- google-private-key \",(0,n.jsx)(e.span,{className:\"token string\",children:`\"-----BEGIN PRIVATE KEY-----\\r\n`})]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string\",children:`MIIEvQIBA\\r\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string\",children:`..\\r\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string\",children:`..\\r\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string\",children:`2DAVOW4c=\\r\n`})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'-----END PRIVATE KEY-----\"'}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"$ vc secret \",(0,n.jsx)(e.span,{className:\"token function\",children:\"add\"}),` google-client-email my-account@project.iam.gserviceaccount.com\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"$ vc secret \",(0,n.jsx)(e.span,{className:\"token function\",children:\"add\"}),\" google-client-id \",(0,n.jsx)(e.span,{className:\"token number\",children:\"721877721877\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"To reference these values locally when using \",(0,n.jsx)(e.code,{children:\"vc dev\"}),\", they need to be added to your \",(0,n.jsx)(e.code,{children:\".env\"}),\" file.\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"GOOGLE_PRIVATE_KEY\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsxs)(e.span,{className:\"token string\",children:['\"-----BEGIN PRIVATE KEY-----',(0,n.jsx)(e.span,{className:\"token entity\",title:\"\\\\n\",children:\"\\\\n\"}),\"DVOW4c=\",(0,n.jsx)(e.span,{className:\"token entity\",title:\"\\\\n\",children:\"\\\\n\"}),\"-----END PRIVATE KEY-----\",(0,n.jsx)(e.span,{className:\"token entity\",title:\"\\\\n\",children:\"\\\\n\"}),'\"']}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"GOOGLE_CLIENT_EMAIL\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),`my-account@project.iam.gserviceaccount.com\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Finally, we need to add the secrets to our \",(0,n.jsx)(e.code,{children:\"vercel.json\"}),\".\"]}),`\n`,(0,n.jsx)(e.div,{className:\"rehype-code-title\",children:\"vercel.json\"}),(0,n.jsx)(e.pre,{className:\"language-json\",children:(0,n.jsxs)(e.code,{className:\"language-json code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"env\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"GOOGLE_PRIVATE_KEY\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"@google-private-key\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"GOOGLE_CLIENT_EMAIL\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"@google-client-email\"'}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"We can now reference the secrets via \",(0,n.jsx)(e.code,{children:\"process.env.GOOGLE_PRIVATE_KEY\"}),\" in our API route.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.strong,{children:\"Note:\"}),\" If you have a lot of environment variables in Vercel, you might need to \",(0,n.jsx)(e.a,{href:\"https://vercel.com/support/articles/how-do-i-workaround-vercel-s-4-kb-environment-variables-limit\",children:\"encrypt your service account\"}),\".\"]}),`\n`,(0,n.jsxs)(e.h2,{id:\"creating-the-api-route\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#creating-the-api-route\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Creating the API Route\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Let's start by creating a new API route at \",(0,n.jsx)(e.code,{children:\"pages/api/page-views.js\"}),\".\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-js\",children:(0,n.jsxs)(e.code,{className:\"language-js code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"export\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"default\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token parameter\",children:[\"req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" res\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token arrow operator\",children:\"=>\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"return\"}),\" res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"status\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"200\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"json\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"To make server-side requests to Google Analytics, we can install the \",(0,n.jsx)(e.a,{href:\"https://github.com/googleapis/google-api-nodejs-client\",children:\"googleapis\"}),\" library.\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"language-bash code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"$ \",(0,n.jsx)(e.span,{className:\"token function\",children:\"yarn\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"add\"}),` googleapis@48.0.0\n`]})})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Then, we can initialize \",(0,n.jsx)(e.code,{children:\"googleapis\"}),\" inside our API route.\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-js\",children:(0,n.jsxs)(e.code,{className:\"language-js code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token imports\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" google \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'googleapis'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"let\"}),\" googleAuth\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"export\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"default\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token parameter\",children:[\"_\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" res\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token arrow operator\",children:\"=>\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  googleAuth \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"google\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"auth\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"GoogleAuth\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"credentials\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"client_email\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" process\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"env\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"GOOGLE_CLIENT_EMAIL\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"private_key\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" process\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"env\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"GOOGLE_PRIVATE_KEY\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"scopes\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'https://www.googleapis.com/auth/analytics.readonly'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" analytics \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" google\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"analytics\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    auth\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"version\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'v3'\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"return\"}),\" res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"status\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"200\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"json\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:`Finally, we want to pull statistics about our site. We'd like to know the total number of views for a given time range.\\r\nTo allow the API route to be re-used, let's pass the start date as a query parameter.`}),`\n`,(0,n.jsx)(e.pre,{className:\"language-js\",children:(0,n.jsx)(e.code,{className:\"language-js code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" startDate \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"query\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"startDate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})})}),`\n`,(0,n.jsx)(e.p,{children:\"Then, we can use the same API route to fetch stats about different time ranges.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-js\",children:(0,n.jsxs)(e.code,{className:\"language-js code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token imports\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" google \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'googleapis'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"let\"}),\" googleAuth\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"export\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"default\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token parameter\",children:[\"_\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" res\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token arrow operator\",children:\"=>\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  googleAuth \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"google\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"auth\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"GoogleAuth\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"credentials\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"client_email\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" process\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"env\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"GOOGLE_CLIENT_EMAIL\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"private_key\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" process\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"env\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"GOOGLE_PRIVATE_KEY\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"scopes\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'https://www.googleapis.com/auth/analytics.readonly'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" analytics \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" google\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"analytics\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    auth\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"version\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'v3'\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" startDate \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"query\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"startDate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" response \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"await\"}),\" analytics\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"data\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"ga\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token string-property property\",children:\"'end-date'\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'today'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"ids\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'ga:186371021'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"metrics\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'ga:pageviews'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token string-property property\",children:\"'start-date'\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),` startDate\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"return\"}),\" res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"status\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"200\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"json\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"pageViews\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" response\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"data\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"rows\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.h2,{id:\"example\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#example\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Example\"]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.em,{children:\"Bonus\"}),\": You can cache the API route with the \",(0,n.jsx)(e.a,{href:\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control\",children:\"cache-control\"}),\" header.\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"language-bash code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"Cache-Control: public, max-age\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"120\"}),\", stale-while-revalidate\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"60\"}),`\n`]})})}),`\n`,(0,n.jsx)(s,{}),`\n`,(0,n.jsxs)(e.h2,{id:\"keep-reading\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#keep-reading\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Keep Reading\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.strong,{children:\"Create a Dashboard with Next.js API Routes\"})}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"Part 1 - \",(0,n.jsx)(e.a,{href:\"/blog/unsplash-api-nextjs\",children:\"Unsplash API\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Part 2 - \",(0,n.jsx)(e.a,{href:\"/blog/youtube-api-nextjs\",children:\"YouTube API\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Part 3 - \",(0,n.jsx)(e.a,{href:\"/blog/google-analytics-api-nextjs\",children:\"Google Analytics API\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Part 4 - \",(0,n.jsx)(e.a,{href:\"/blog/fetching-data-with-swr\",children:\"Fetching Data with SWR\"})]}),`\n`]})]})}function f(a={}){let{wrapper:e}=a.components||{};return e?(0,n.jsx)(e,Object.assign({},a,{children:(0,n.jsx)(p,a)})):p(a)}var b=f;function A(a,e,s){throw new Error(\"Expected \"+(e?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\"+(s?\"\\nIt\\u2019s referenced in your code at `\"+s+\"` in `D:\\\\Linux_Share\\\\reactapp\\\\rifan-blog\\\\data\\\\blog\\\\_mdx_bundler_entry_point-b59e5586-1b6c-42e5-89df-dbe8c3d66f3b.mdx`\":\"\"))}return w(_);})();\n;return Component;"
  },
  "_id": "blog/google-analytics-api-nextjs.mdx",
  "_raw": {
    "sourceFilePath": "blog/google-analytics-api-nextjs.mdx",
    "sourceFileName": "google-analytics-api-nextjs.mdx",
    "sourceFileDir": "blog",
    "contentType": "mdx",
    "flattenedPath": "blog/google-analytics-api-nextjs"
  },
  "type": "Blog",
  "readingTime": {
    "text": "4 min read",
    "minutes": 3.815,
    "time": 228900,
    "words": 763
  },
  "wordCount": 765,
  "tweetIds": [],
  "slug": "google-analytics-api-nextjs"
}