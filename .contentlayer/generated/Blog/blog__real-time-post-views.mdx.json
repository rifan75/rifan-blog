{
  "title": "Real-Time Blog Post Views With Next.js and Firebase",
  "publishedAt": "2019-08-21",
  "summary": "Want more accurate page view counts? Learn how to track real-time post views using Firebase and Next.js.",
  "image": "/static/images/real-time-post-views/banner.png",
  "body": {
    "raw": "\r\n<Image\r\n  alt={`Blog Post Views`}\r\n  src={`/static/images/real-time-post-views/chart.png`}\r\n  width={1110}\r\n  height={624}\r\n  priority\r\n/>\r\n\r\nOne metric for a website's success is the amount of traffic it receives.\r\nFor a blog, this translates to page views. Articles with lots of views indicate the content your readers care most about.\r\nThis helps drive future articles.\r\n\r\nMost people measure view counts via analytics (like [Google Analytics](https://analytics.google.com/analytics/web/)).\r\nHowever, with the rise of ad-blocking browser extensions, these counts are likely [~10% off](https://moz.com/blog/analytics-black-holes) (especially if your target market is tech).\r\nWhat if we could have better accuracy, better performance, and better privacy for our users?\r\n\r\nThis post will show how to display real-time view counts for a given blog post using [Firebase](https://firebase.google.com/docs/database).\r\nWe can host and deploy this entire solution **for free** using Firebase's [free tier](https://firebase.google.com/pricing/) and [Vercel](https://vercel.com).\r\n\r\n## Setting Up Firebase\r\n\r\n1.  If you do not have a Firebase account, create one first.\r\n2.  Create a new project.\r\n3.  Navigate to \"Database\" and click \"Create Database\".\r\n    <Image\r\n      alt={`Create Firebase Database`}\r\n      src={`/static/images/real-time-post-views/firebase/step1.png`}\r\n      width={1000}\r\n      height={534}\r\n    />\r\n4.  Start in test mode and click next.\r\n    <Image\r\n      alt={`Create Firebase Database`}\r\n      src={`/static/images/real-time-post-views/firebase/step2.png`}\r\n      width={1000}\r\n      height={533}\r\n    />\r\n5.  Choose your database location and click done.\r\n    <Image\r\n      alt={`Create Firebase Database`}\r\n      src={`/static/images/real-time-post-views/firebase/step3.png`}\r\n      width={1000}\r\n      height={532}\r\n    />\r\n6.  In the top left, click on \"Project Settings\".\r\n    <Image\r\n      alt={`Create Firebase Database`}\r\n      src={`/static/images/real-time-post-views/firebase/step4.png`}\r\n      width={979}\r\n      height={386}\r\n    />\r\n7.  Navigate to \"Service Accounts\" tab and click \"Generate new private key\". Save the `.json` file. You will need this later.\r\n    <Image\r\n      alt={`Create Firebase Database`}\r\n      src={`/static/images/real-time-post-views/firebase/step5.png`}\r\n      width={1000}\r\n      height={535}\r\n    />\r\n\r\nWe're finished! ðŸŽ‰ You have successfully set up a realtime database, as well as generated credentials to connect to the database.\r\n\r\n## Connecting To Firebase\r\n\r\nFirst, we need to install the `firebase-admin` server-side SDK.\r\n\r\n```bash\r\n$ yarn add firebase-admin\r\n```\r\n\r\nNext, we need to create an `.env.local` file to add the values for the Firebase service account `.json` file.\r\nSpecifically, `private_key`, `project_id`, and `client_email`.\r\n\r\n```bash:.env\r\nNEXT_PUBLIC_FIREBASE_PROJECT_ID=replace-me\r\nFIREBASE_CLIENT_EMAIL=replace-me\r\nFIREBASE_PRIVATE_KEY=\"replace-me\"\r\n```\r\n\r\nMake sure you include the quotes around \"replace-me\" for `FIREBASE_PRIVATE_KEY`.\r\n\r\nYou will need to restart your application to load new environment variables.\r\nCreate a new file `lib/firebase.js` to initialize the application and establish a connection.\r\n\r\n```js:lib/firebase.js\r\nimport * as admin from 'firebase-admin';\r\n\r\nif (!admin.apps.length) {\r\n  admin.initializeApp({\r\n    credential: admin.credential.cert({\r\n      projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,\r\n      clientEmail: process.env.FIREBASE_CLIENT_EMAIL,\r\n      privateKey: process.env.FIREBASE_PRIVATE_KEY.replace(/\\\\n/g, '\\n')\r\n    })\r\n  });\r\n}\r\n\r\nconst db = admin.firestore();\r\n\r\nexport { db };\r\n```\r\n\r\n## Tracking Views\r\n\r\nTo track a view, we need to look at the database for `views -> id`. Let's create a new [API Route](https://nextjs.org/docs/api-routes/introduction)\r\nto communicate with our database and increment the views for a given `id`.\r\n\r\n[API Routes](https://nextjs.org/docs/api-routes/introduction) provide a straight-forward solution for building an API inside Next.js.\r\nAll you need to get started is an `api/` folder inside your main `pages/` folder where your routes live. Every file inside `pages/api/` is mapped to `/api/*`.\r\n\r\n```js:pages/api/views/[slug].js\r\nimport { db } from '../../lib/firebase';\r\n\r\nexport default async (req, res) => {\r\n  if (req.method === 'POST') {\r\n    const ref = db.ref('views').child(req.query.slug);\r\n    const { snapshot } = await ref.transaction((currentViews) => {\r\n      if (currentViews === null) {\r\n        return 1;\r\n      }\r\n\r\n      return currentViews + 1;\r\n    });\r\n\r\n    return res.status(200).json({\r\n      total: snapshot.val()\r\n    });\r\n  }\r\n};\r\n```\r\n\r\nFor an API route to work, you need to export a default function (i.e., **request handler**), which receives the following parameters:\r\n\r\n- `req`: An instance of [http.IncomingMessage](https://nodejs.org/api/http.html#http_class_http_incomingmessage), plus some [pre-built middlewares](https://nextjs.org/docs/api-routes/api-middlewares).\r\n- `res`: An instance of [http.ServerResponse](https://nodejs.org/api/http.html#http_class_http_serverresponse), plus some [helper functions](https://nextjs.org/docs/api-routes/response-helpers).\r\n\r\n## Testing View Counts\r\n\r\nUsing your favorite REST client or your browser, you can now hit `http://localhost:3000/api/views/my-blog` to log a view.\r\nWe can confirm it was logged correctly by checking Firebase.\r\n\r\n<Image\r\n  alt={`Testing Firebase`}\r\n  src={`/static/images/real-time-post-views/testing-database.png`}\r\n  width={1000}\r\n  height={562}\r\n/>\r\n\r\n## Fetching Data from Firebase\r\n\r\n[SWR](https://swr.vercel.app/) is a React Hooks library for remote data fetching.\r\nSWR first returns the data from cache (stale), then sends the fetch request (revalidate), and finally comes with the up-to-date data again.\r\n\r\nThis will allow us to fetch view counts from Firebase.\r\nIf you re-focus or switch between tabs, SWR will [automatically revalidate data](https://swr.now.sh/#focus-revalidation).\r\n\r\nLet's install SWR now.\r\n\r\n```bash\r\n$ yarn add swr\r\n```\r\n\r\nNext, we need to update our API Route to fetch the views for a given post.\r\n\r\n```js:pages/api/views/[slug].js\r\nimport { db } from '../../lib/firebase';\r\n\r\nexport default async (req, res) => {\r\n  if (req.method === 'POST') {\r\n    const ref = db.ref('views').child(req.query.slug);\r\n    const { snapshot } = await ref.transaction((currentViews) => {\r\n      if (currentViews === null) {\r\n        return 1;\r\n      }\r\n\r\n      return currentViews + 1;\r\n    });\r\n\r\n    return res.status(200).json({\r\n      total: snapshot.val()\r\n    });\r\n  }\r\n\r\n  if (req.method === 'GET') {\r\n    const snapshot = await db.ref('views').child(req.query.slug).once('value');\r\n    const views = snapshot.val();\r\n\r\n    return res.status(200).json({ total: views });\r\n  }\r\n};\r\n```\r\n\r\n## View Counter\r\n\r\nLet's create a `ViewCounter` component to use SWR.\r\n\r\n```jsx:components/ViewCounter.js\r\nimport { useEffect } from 'react';\r\nimport useSWR from 'swr';\r\n\r\nasync function fetcher(...args) {\r\n  const res = await fetch(...args);\r\n\r\n  return res.json();\r\n}\r\n\r\nexport default function ViewCounter({ slug }) {\r\n  const { data } = useSWR(`/api/views/${slug}`, fetcher);\r\n  const views = new Number(data?.total);\r\n\r\n  useEffect(() => {\r\n    const registerView = () =>\r\n      fetch(`/api/views/${slug}`, {\r\n        method: 'POST'\r\n      });\r\n\r\n    registerView();\r\n  }, [slug]);\r\n\r\n  return `${views > 0 ? views.toLocaleString() : 'â€“â€“â€“'} views`;\r\n}\r\n\r\n```\r\n\r\nFinally, we can consume the view counter in our blog post and pass in the ID.\r\n\r\n```jsx\r\n<ViewCounter slug=\"my-post\" />\r\n```\r\n\r\n## Deployment with Vercel\r\n\r\nWhen adding your Firebase private key inside the Vercel dashboard, ensure that you\r\nconvert new line characters (`\\n`) to actual new lines. For example, here's a fake private key.\r\n\r\n```bash\r\n-----BEGIN PRIVATE KEY-----\r\nMIIEvAIBADANBgkdhkiG9w0BAQEFABBBBKYwggSiAgEAAoIBAQClyaHok1jDXoVg\r\nJDbtpaNeR7tdHTIwpplhfzXBWBsYc+aTIKZssYYJoFQ6RIV4ky5Kau05CrAoUSAr\r\nFWuuqbtnW/2pTiG2YNwmEMDOMWusdWnMDyyTtx7krA1BZuQ1HrrNjhoNvMpBnO9o\r\nELBo/BQbhDg7lhv1VWjsfRIFNBKkEG7qPkRZ2FUvbXlpsPueJbEREe4IYCKlhvJA\r\nLsoG5HfdePv+7Bhv2IXBd3+JZhP+LnWeAxvsxmUYA4Q1sF/ItfMRLvX/b3c6UyQh\r\nX+hn7KrsUPIuITJmWI+27tzt0Hz8W2JXy47PpSW3+xyPuLfnGZREbQDGiPT9tLPh\r\n1Go9FpWvAgMBAAECggEAFY8/F7bvIjrXJZxTVVX+IbM06YV/H/z5j08pUVcN4Xhr\r\nns/pI89abTLtCNQam4iFxsp+uKt+ISPDEBsw+YvElkvWnhdEKiYjTwtsOPcU1V5S\r\nN3vbEkAU1TjiWZ7zL0IcleWAuX342gN+7JEQkAAfFxvWCV8fsjQ7BGuix+7sZ1xP\r\nOxaD9PCcT4CHm093ksn2uv0BcQD1ect0zxlyjKyBiDLwwUWmDRgeZwNw0ca09TAd\r\nQVvB9tewXmSQfXaim9Cm8bU1sN3kUSLWZf1ItU9cC0EUFnf3cttqyDfviYi0gg9p\r\n7uAdbFka89vz3O3d/b+M8YrDqVvduJuqpAphr+v7sQKBgQDmSqaQ09uBs/G4KvcB\r\nyzF1zjD1moeIZ/EnifNQ1/fs+0gbgthHFpH2ZCn7XAc0veF6nqSaUxSUVOAujfgP\r\nxlOxt+q56iZ+LpQzemgZDOeclIdqSEJ3kNP1QhNtVvhdWfJtVO4ctvt2ZOKKgXnf\r\nu2hFwiV4W5JKWWFNZD7E3jA6nQKBgQC3yp3H6NLpKrK4UrRgrwVwu7ox8YTFxfmG\r\nk4k/mul7GxegMaCKgvf4xibg8WnvAszB6wdqdOtp5HsEmAMUG3LjRwyJEQs6niJJ\r\nWxH4YHg5deONTbG9NLDUGW4Frq577zfj3jKwsIWE/5zczFn04S1NRyfsdzMVoP01\r\n8qvSPClJuwKBgAj0/FeDtfTsf8lO+n56XbkcRPE4im72w/1qsykAzWbNOze+tcUe\r\nDp1LtgpNwQX/IKb5RqOt+Y3vYyzMXsqWRykRYhLJ9adQvnjmGOhohRWk/UNX/iXS\r\nXzwZztGg4VYYKoKwG/bH8y3erKUAdjIKgvq7m2N8BEuaAFvXO03C6pNNAoGALski\r\nTyBiiD55TlinWDFVljQDmvEbVmkmMu7dslZR9yeXZQ0dDAV48Fgoz3xE9jXlP7v/\r\noEbxInyqICo+JmEyZs7QTxgKnrpgigHn2i1cjWwIKBFOHJcMKIHssv+bpSrpNFV8\r\n2+OjqY6UNNTEVYT4zkI91IEnfOsFajVDLfponD8CgYBajSsT31li/QB2GT7vYexT\r\ndkAg3WB7iX/RLzt81H4fpN3HXd0BklSlWLZDLu9Cmd+XgA1iKHL+pLkaocs1zM/L\r\nZGUJECjLVIPDySOUcX7SGTrChN3Q1Rn0dXdUsrWkBWopGmtz1D99aIzfylXnnyjQ\r\nIlpxVgdxp5tb9JOG3aoMMg==\r\n-----END PRIVATE KEY-----\r\n```\r\n\r\nNote the extra new line at the end.\r\n\r\n## Conclusion\r\n\r\nYou can view a completed example by checking out [this blog post's source code](https://github.com/leerob/leerob.io).\r\nI was able to migrate my page views from Google Analytics into Firebase via their web interface.\r\n\r\n<Image\r\n  alt={`Blog Post Views`}\r\n  src={`/static/images/real-time-post-views/blog-post-views.png`}\r\n  width={1000}\r\n  height={599}\r\n/>\r\n\r\n**Note**: If your site receives a lot of traffic, you'll need to upgrade from the Spark plan (free) to Blaze (pay-as-you-go).\r\nOn Spark, you can only have 100 simultaneous connections. With Blaze, you can have 100k.\r\n\r\n<Image\r\n  alt={`Database Usage`}\r\n  src={`/static/images/real-time-post-views/db-usage.png`}\r\n  width={1000}\r\n  height={529}\r\n/>\r\n",
    "code": "var Component=(()=>{var d=Object.create;var t=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var u=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty;var k=(a,e)=>()=>(e||a((e={exports:{}}).exports,e),e.exports),g=(a,e)=>{for(var s in e)t(a,s,{get:e[s],enumerable:!0})},i=(a,e,s,l)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let c of m(e))!N.call(a,c)&&c!==s&&t(a,c,{get:()=>e[c],enumerable:!(l=h(e,c))||l.enumerable});return a};var f=(a,e,s)=>(s=a!=null?d(u(a)):{},i(e||!a||!a.__esModule?t(s,\"default\",{value:a,enumerable:!0}):s,a)),w=a=>i(t({},\"__esModule\",{value:!0}),a);var r=k((j,o)=>{o.exports=_jsx_runtime});var I={};g(I,{default:()=>v,frontmatter:()=>y});var n=f(r()),y={title:\"Real-Time Blog Post Views With Next.js and Firebase\",publishedAt:\"2019-08-21\",summary:\"Want more accurate page view counts? Learn how to track real-time post views using Firebase and Next.js.\",image:\"/static/images/real-time-post-views/banner.png\"};function p(a){let e=Object.assign({p:\"p\",a:\"a\",strong:\"strong\",h2:\"h2\",span:\"span\",ol:\"ol\",li:\"li\",code:\"code\",pre:\"pre\",div:\"div\",ul:\"ul\"},a.components),{Image:s}=e;return s||E(\"Image\",!0,\"8:1-14:3\"),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s,{alt:\"Blog Post Views\",src:\"/static/images/real-time-post-views/chart.png\",width:1110,height:624,priority:!0}),`\n`,(0,n.jsx)(e.p,{children:`One metric for a website's success is the amount of traffic it receives.\\r\nFor a blog, this translates to page views. Articles with lots of views indicate the content your readers care most about.\\r\nThis helps drive future articles.`}),`\n`,(0,n.jsxs)(e.p,{children:[\"Most people measure view counts via analytics (like \",(0,n.jsx)(e.a,{href:\"https://analytics.google.com/analytics/web/\",children:\"Google Analytics\"}),`).\\r\nHowever, with the rise of ad-blocking browser extensions, these counts are likely `,(0,n.jsx)(e.a,{href:\"https://moz.com/blog/analytics-black-holes\",children:\"~10% off\"}),` (especially if your target market is tech).\\r\nWhat if we could have better accuracy, better performance, and better privacy for our users?`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"This post will show how to display real-time view counts for a given blog post using \",(0,n.jsx)(e.a,{href:\"https://firebase.google.com/docs/database\",children:\"Firebase\"}),`.\\r\nWe can host and deploy this entire solution `,(0,n.jsx)(e.strong,{children:\"for free\"}),\" using Firebase's \",(0,n.jsx)(e.a,{href:\"https://firebase.google.com/pricing/\",children:\"free tier\"}),\" and \",(0,n.jsx)(e.a,{href:\"https://vercel.com\",children:\"Vercel\"}),\".\"]}),`\n`,(0,n.jsxs)(e.h2,{id:\"setting-up-firebase\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#setting-up-firebase\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Setting Up Firebase\"]}),`\n`,(0,n.jsxs)(e.ol,{children:[`\n`,(0,n.jsx)(e.li,{children:\"If you do not have a Firebase account, create one first.\"}),`\n`,(0,n.jsx)(e.li,{children:\"Create a new project.\"}),`\n`,(0,n.jsxs)(e.li,{children:['Navigate to \"Database\" and click \"Create Database\".',`\n`,(0,n.jsx)(s,{alt:\"Create Firebase Database\",src:\"/static/images/real-time-post-views/firebase/step1.png\",width:1e3,height:534}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Start in test mode and click next.\",`\n`,(0,n.jsx)(s,{alt:\"Create Firebase Database\",src:\"/static/images/real-time-post-views/firebase/step2.png\",width:1e3,height:533}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Choose your database location and click done.\",`\n`,(0,n.jsx)(s,{alt:\"Create Firebase Database\",src:\"/static/images/real-time-post-views/firebase/step3.png\",width:1e3,height:532}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:['In the top left, click on \"Project Settings\".',`\n`,(0,n.jsx)(s,{alt:\"Create Firebase Database\",src:\"/static/images/real-time-post-views/firebase/step4.png\",width:979,height:386}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:['Navigate to \"Service Accounts\" tab and click \"Generate new private key\". Save the ',(0,n.jsx)(e.code,{children:\".json\"}),\" file. You will need this later.\",`\n`,(0,n.jsx)(s,{alt:\"Create Firebase Database\",src:\"/static/images/real-time-post-views/firebase/step5.png\",width:1e3,height:535}),`\n`]}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"We're finished! \\u{1F389} You have successfully set up a realtime database, as well as generated credentials to connect to the database.\"}),`\n`,(0,n.jsxs)(e.h2,{id:\"connecting-to-firebase\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#connecting-to-firebase\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Connecting To Firebase\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"First, we need to install the \",(0,n.jsx)(e.code,{children:\"firebase-admin\"}),\" server-side SDK.\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"language-bash code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"$ \",(0,n.jsx)(e.span,{className:\"token function\",children:\"yarn\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"add\"}),` firebase-admin\n`]})})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Next, we need to create an \",(0,n.jsx)(e.code,{children:\".env.local\"}),\" file to add the values for the Firebase service account \",(0,n.jsx)(e.code,{children:\".json\"}),` file.\\r\nSpecifically, `,(0,n.jsx)(e.code,{children:\"private_key\"}),\", \",(0,n.jsx)(e.code,{children:\"project_id\"}),\", and \",(0,n.jsx)(e.code,{children:\"client_email\"}),\".\"]}),`\n`,(0,n.jsx)(e.div,{className:\"rehype-code-title\",children:\".env\"}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"NEXT_PUBLIC_FIREBASE_PROJECT_ID\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),`replace-me\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"FIREBASE_CLIENT_EMAIL\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),`replace-me\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"FIREBASE_PRIVATE_KEY\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"replace-me\"'}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:['Make sure you include the quotes around \"replace-me\" for ',(0,n.jsx)(e.code,{children:\"FIREBASE_PRIVATE_KEY\"}),\".\"]}),`\n`,(0,n.jsxs)(e.p,{children:[`You will need to restart your application to load new environment variables.\\r\nCreate a new file `,(0,n.jsx)(e.code,{children:\"lib/firebase.js\"}),\" to initialize the application and establish a connection.\"]}),`\n`,(0,n.jsx)(e.div,{className:\"rehype-code-title\",children:\"lib/firebase.js\"}),(0,n.jsx)(e.pre,{className:\"language-js\",children:(0,n.jsxs)(e.code,{className:\"language-js code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token imports\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"as\"}),\" admin\"]}),\" \",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'firebase-admin'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"!\"}),\"admin\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"apps\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"length\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  admin\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"initializeApp\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"credential\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" admin\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"credential\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"cert\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"projectId\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" process\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"env\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"NEXT_PUBLIC_FIREBASE_PROJECT_ID\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"clientEmail\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" process\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"env\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"FIREBASE_CLIENT_EMAIL\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"privateKey\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" process\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"env\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"FIREBASE_PRIVATE_KEY\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"replace\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token regex\",children:[(0,n.jsx)(e.span,{className:\"token regex-delimiter\",children:\"/\"}),(0,n.jsxs)(e.span,{className:\"token regex-source language-regex\",children:[(0,n.jsx)(e.span,{className:\"token special-escape escape\",children:\"\\\\\\\\\"}),\"n\"]}),(0,n.jsx)(e.span,{className:\"token regex-delimiter\",children:\"/\"}),(0,n.jsx)(e.span,{className:\"token regex-flags\",children:\"g\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'\\\\n'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" db \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" admin\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"firestore\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"export\"}),\" \",(0,n.jsxs)(e.span,{className:\"token exports\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" db \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.h2,{id:\"tracking-views\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#tracking-views\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Tracking Views\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"To track a view, we need to look at the database for \",(0,n.jsx)(e.code,{children:\"views -> id\"}),\". Let's create a new \",(0,n.jsx)(e.a,{href:\"https://nextjs.org/docs/api-routes/introduction\",children:\"API Route\"}),`\\r\nto communicate with our database and increment the views for a given `,(0,n.jsx)(e.code,{children:\"id\"}),\".\"]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://nextjs.org/docs/api-routes/introduction\",children:\"API Routes\"}),` provide a straight-forward solution for building an API inside Next.js.\\r\nAll you need to get started is an `,(0,n.jsx)(e.code,{children:\"api/\"}),\" folder inside your main \",(0,n.jsx)(e.code,{children:\"pages/\"}),\" folder where your routes live. Every file inside \",(0,n.jsx)(e.code,{children:\"pages/api/\"}),\" is mapped to \",(0,n.jsx)(e.code,{children:\"/api/*\"}),\".\"]}),`\n`,(0,n.jsx)(e.div,{className:\"rehype-code-title\",children:\"pages/api/views/[slug].js\"}),(0,n.jsx)(e.pre,{className:\"language-js\",children:(0,n.jsxs)(e.code,{className:\"language-js code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token imports\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" db \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'../../lib/firebase'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"export\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"default\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token parameter\",children:[\"req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" res\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token arrow operator\",children:\"=>\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"method\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"===\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'POST'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" ref \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" db\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"ref\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'views'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"child\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"query\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"slug\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" snapshot \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"await\"}),\" ref\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"transaction\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token parameter\",children:\"currentViews\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token arrow operator\",children:\"=>\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"currentViews \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"===\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword null nil\",children:\"null\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"return\"}),\" currentViews \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"return\"}),\" res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"status\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"200\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"json\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"total\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" snapshot\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"val\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"For an API route to work, you need to export a default function (i.e., \",(0,n.jsx)(e.strong,{children:\"request handler\"}),\"), which receives the following parameters:\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"req\"}),\": An instance of \",(0,n.jsx)(e.a,{href:\"https://nodejs.org/api/http.html#http_class_http_incomingmessage\",children:\"http.IncomingMessage\"}),\", plus some \",(0,n.jsx)(e.a,{href:\"https://nextjs.org/docs/api-routes/api-middlewares\",children:\"pre-built middlewares\"}),\".\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"res\"}),\": An instance of \",(0,n.jsx)(e.a,{href:\"https://nodejs.org/api/http.html#http_class_http_serverresponse\",children:\"http.ServerResponse\"}),\", plus some \",(0,n.jsx)(e.a,{href:\"https://nextjs.org/docs/api-routes/response-helpers\",children:\"helper functions\"}),\".\"]}),`\n`]}),`\n`,(0,n.jsxs)(e.h2,{id:\"testing-view-counts\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#testing-view-counts\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Testing View Counts\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Using your favorite REST client or your browser, you can now hit \",(0,n.jsx)(e.code,{children:\"http://localhost:3000/api/views/my-blog\"}),` to log a view.\\r\nWe can confirm it was logged correctly by checking Firebase.`]}),`\n`,(0,n.jsx)(s,{alt:\"Testing Firebase\",src:\"/static/images/real-time-post-views/testing-database.png\",width:1e3,height:562}),`\n`,(0,n.jsxs)(e.h2,{id:\"fetching-data-from-firebase\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#fetching-data-from-firebase\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Fetching Data from Firebase\"]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://swr.vercel.app/\",children:\"SWR\"}),` is a React Hooks library for remote data fetching.\\r\nSWR first returns the data from cache (stale), then sends the fetch request (revalidate), and finally comes with the up-to-date data again.`]}),`\n`,(0,n.jsxs)(e.p,{children:[`This will allow us to fetch view counts from Firebase.\\r\nIf you re-focus or switch between tabs, SWR will `,(0,n.jsx)(e.a,{href:\"https://swr.now.sh/#focus-revalidation\",children:\"automatically revalidate data\"}),\".\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Let's install SWR now.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"language-bash code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"$ \",(0,n.jsx)(e.span,{className:\"token function\",children:\"yarn\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"add\"}),` swr\n`]})})}),`\n`,(0,n.jsx)(e.p,{children:\"Next, we need to update our API Route to fetch the views for a given post.\"}),`\n`,(0,n.jsx)(e.div,{className:\"rehype-code-title\",children:\"pages/api/views/[slug].js\"}),(0,n.jsx)(e.pre,{className:\"language-js\",children:(0,n.jsxs)(e.code,{className:\"language-js code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token imports\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" db \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'../../lib/firebase'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"export\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"default\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token parameter\",children:[\"req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" res\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token arrow operator\",children:\"=>\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"method\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"===\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'POST'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" ref \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" db\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"ref\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'views'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"child\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"query\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"slug\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" snapshot \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"await\"}),\" ref\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"transaction\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token parameter\",children:\"currentViews\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token arrow operator\",children:\"=>\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"currentViews \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"===\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword null nil\",children:\"null\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"return\"}),\" currentViews \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"return\"}),\" res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"status\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"200\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"json\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"total\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" snapshot\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"val\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"method\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"===\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'GET'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" snapshot \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"await\"}),\" db\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"ref\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'views'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"child\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"query\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"slug\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"once\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'value'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" views \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" snapshot\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"val\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"return\"}),\" res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"status\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"200\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"json\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"total\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" views \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.h2,{id:\"view-counter\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#view-counter\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"View Counter\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Let's create a \",(0,n.jsx)(e.code,{children:\"ViewCounter\"}),\" component to use SWR.\"]}),`\n`,(0,n.jsx)(e.div,{className:\"rehype-code-title\",children:\"components/ViewCounter.js\"}),(0,n.jsx)(e.pre,{className:\"language-jsx\",children:(0,n.jsxs)(e.code,{className:\"language-jsx code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token imports\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" useEffect \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'react'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"import\"}),\" \",(0,n.jsx)(e.span,{className:\"token imports\",children:\"useSWR\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'swr'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"fetcher\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token parameter\",children:[(0,n.jsx)(e.span,{className:\"token spread operator\",children:\"...\"}),\"args\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" res \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"await\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"fetch\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token spread operator\",children:\"...\"}),\"args\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"return\"}),\" res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"json\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"export\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"default\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"ViewCounter\"})}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token parameter\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" slug \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" data \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"useSWR\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token template-string\",children:[(0,n.jsx)(e.span,{className:\"token template-punctuation string\",children:\"`\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"/api/views/\"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token interpolation-punctuation punctuation\",children:\"${\"}),\"slug\",(0,n.jsx)(e.span,{className:\"token interpolation-punctuation punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token template-punctuation string\",children:\"`\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" fetcher\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" views \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Number\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"data\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"?.\"}),\"total\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token function\",children:\"useEffect\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token arrow operator\",children:\"=>\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token function-variable function\",children:\"registerView\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token arrow operator\",children:\"=>\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token function\",children:\"fetch\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token template-string\",children:[(0,n.jsx)(e.span,{className:\"token template-punctuation string\",children:\"`\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"/api/views/\"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token interpolation-punctuation punctuation\",children:\"${\"}),\"slug\",(0,n.jsx)(e.span,{className:\"token interpolation-punctuation punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token template-punctuation string\",children:\"`\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"method\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'POST'\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"registerView\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"slug\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"return\"}),\" \",(0,n.jsxs)(e.span,{className:\"token template-string\",children:[(0,n.jsx)(e.span,{className:\"token template-punctuation string\",children:\"`\"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token interpolation-punctuation punctuation\",children:\"${\"}),\"views \",(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),\" views\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"toLocaleString\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'\\u2013\\u2013\\u2013'\"}),(0,n.jsx)(e.span,{className:\"token interpolation-punctuation punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:\" views\"}),(0,n.jsx)(e.span,{className:\"token template-punctuation string\",children:\"`\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\\r\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Finally, we can consume the view counter in our blog post and pass in the ID.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-jsx\",children:(0,n.jsx)(e.code,{className:\"language-jsx code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ViewCounter\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"slug\"}),(0,n.jsxs)(e.span,{className:\"token attr-value\",children:[(0,n.jsx)(e.span,{className:\"token punctuation attr-equals\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:'\"'}),\"my-post\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:'\"'})]}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"/>\"})]}),`\n`]})})}),`\n`,(0,n.jsxs)(e.h2,{id:\"deployment-with-vercel\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#deployment-with-vercel\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Deployment with Vercel\"]}),`\n`,(0,n.jsxs)(e.p,{children:[`When adding your Firebase private key inside the Vercel dashboard, ensure that you\\r\nconvert new line characters (`,(0,n.jsx)(e.code,{children:\"\\\\n\"}),\") to actual new lines. For example, here's a fake private key.\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`-----BEGIN PRIVATE KEY-----\\r\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`MIIEvAIBADANBgkdhkiG9w0BAQEFABBBBKYwggSiAgEAAoIBAQClyaHok1jDXoVg\\r\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`JDbtpaNeR7tdHTIwpplhfzXBWBsYc+aTIKZssYYJoFQ6RIV4ky5Kau05CrAoUSAr\\r\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`FWuuqbtnW/2pTiG2YNwmEMDOMWusdWnMDyyTtx7krA1BZuQ1HrrNjhoNvMpBnO9o\\r\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`ELBo/BQbhDg7lhv1VWjsfRIFNBKkEG7qPkRZ2FUvbXlpsPueJbEREe4IYCKlhvJA\\r\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`LsoG5HfdePv+7Bhv2IXBd3+JZhP+LnWeAxvsxmUYA4Q1sF/ItfMRLvX/b3c6UyQh\\r\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`X+hn7KrsUPIuITJmWI+27tzt0Hz8W2JXy47PpSW3+xyPuLfnGZREbQDGiPT9tLPh\\r\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`1Go9FpWvAgMBAAECggEAFY8/F7bvIjrXJZxTVVX+IbM06YV/H/z5j08pUVcN4Xhr\\r\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`ns/pI89abTLtCNQam4iFxsp+uKt+ISPDEBsw+YvElkvWnhdEKiYjTwtsOPcU1V5S\\r\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`N3vbEkAU1TjiWZ7zL0IcleWAuX342gN+7JEQkAAfFxvWCV8fsjQ7BGuix+7sZ1xP\\r\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`OxaD9PCcT4CHm093ksn2uv0BcQD1ect0zxlyjKyBiDLwwUWmDRgeZwNw0ca09TAd\\r\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`QVvB9tewXmSQfXaim9Cm8bU1sN3kUSLWZf1ItU9cC0EUFnf3cttqyDfviYi0gg9p\\r\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`7uAdbFka89vz3O3d/b+M8YrDqVvduJuqpAphr+v7sQKBgQDmSqaQ09uBs/G4KvcB\\r\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`yzF1zjD1moeIZ/EnifNQ1/fs+0gbgthHFpH2ZCn7XAc0veF6nqSaUxSUVOAujfgP\\r\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`xlOxt+q56iZ+LpQzemgZDOeclIdqSEJ3kNP1QhNtVvhdWfJtVO4ctvt2ZOKKgXnf\\r\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`u2hFwiV4W5JKWWFNZD7E3jA6nQKBgQC3yp3H6NLpKrK4UrRgrwVwu7ox8YTFxfmG\\r\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`k4k/mul7GxegMaCKgvf4xibg8WnvAszB6wdqdOtp5HsEmAMUG3LjRwyJEQs6niJJ\\r\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`WxH4YHg5deONTbG9NLDUGW4Frq577zfj3jKwsIWE/5zczFn04S1NRyfsdzMVoP01\\r\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`8qvSPClJuwKBgAj0/FeDtfTsf8lO+n56XbkcRPE4im72w/1qsykAzWbNOze+tcUe\\r\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`Dp1LtgpNwQX/IKb5RqOt+Y3vYyzMXsqWRykRYhLJ9adQvnjmGOhohRWk/UNX/iXS\\r\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`XzwZztGg4VYYKoKwG/bH8y3erKUAdjIKgvq7m2N8BEuaAFvXO03C6pNNAoGALski\\r\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`TyBiiD55TlinWDFVljQDmvEbVmkmMu7dslZR9yeXZQ0dDAV48Fgoz3xE9jXlP7v/\\r\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`oEbxInyqICo+JmEyZs7QTxgKnrpgigHn2i1cjWwIKBFOHJcMKIHssv+bpSrpNFV8\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),`+OjqY6UNNTEVYT4zkI91IEnfOsFajVDLfponD8CgYBajSsT31li/QB2GT7vYexT\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`dkAg3WB7iX/RLzt81H4fpN3HXd0BklSlWLZDLu9Cmd+XgA1iKHL+pLkaocs1zM/L\\r\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`ZGUJECjLVIPDySOUcX7SGTrChN3Q1Rn0dXdUsrWkBWopGmtz1D99aIzfylXnnyjQ\\r\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"IlpxVgdxp5tb9JOG3aoMMg\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),`\\r\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`-----END PRIVATE KEY-----\n`})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Note the extra new line at the end.\"}),`\n`,(0,n.jsxs)(e.h2,{id:\"conclusion\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#conclusion\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Conclusion\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"You can view a completed example by checking out \",(0,n.jsx)(e.a,{href:\"https://github.com/leerob/leerob.io\",children:\"this blog post's source code\"}),`.\\r\nI was able to migrate my page views from Google Analytics into Firebase via their web interface.`]}),`\n`,(0,n.jsx)(s,{alt:\"Blog Post Views\",src:\"/static/images/real-time-post-views/blog-post-views.png\",width:1e3,height:599}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.strong,{children:\"Note\"}),`: If your site receives a lot of traffic, you'll need to upgrade from the Spark plan (free) to Blaze (pay-as-you-go).\\r\nOn Spark, you can only have 100 simultaneous connections. With Blaze, you can have 100k.`]}),`\n`,(0,n.jsx)(s,{alt:\"Database Usage\",src:\"/static/images/real-time-post-views/db-usage.png\",width:1e3,height:529})]})}function b(a={}){let{wrapper:e}=a.components||{};return e?(0,n.jsx)(e,Object.assign({},a,{children:(0,n.jsx)(p,a)})):p(a)}var v=b;function E(a,e,s){throw new Error(\"Expected \"+(e?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\"+(s?\"\\nIt\\u2019s referenced in your code at `\"+s+\"` in `D:\\\\Linux_Share\\\\reactapp\\\\rifan-blog\\\\data\\\\blog\\\\_mdx_bundler_entry_point-cf384c8c-e99a-4699-97b5-d1e48f1398e0.mdx`\":\"\"))}return w(I);})();\n;return Component;"
  },
  "_id": "blog/real-time-post-views.mdx",
  "_raw": {
    "sourceFilePath": "blog/real-time-post-views.mdx",
    "sourceFileName": "real-time-post-views.mdx",
    "sourceFileDir": "blog",
    "contentType": "mdx",
    "flattenedPath": "blog/real-time-post-views"
  },
  "type": "Blog",
  "readingTime": {
    "text": "6 min read",
    "minutes": 5.02,
    "time": 301200,
    "words": 1004
  },
  "wordCount": 1006,
  "tweetIds": [],
  "slug": "real-time-post-views"
}